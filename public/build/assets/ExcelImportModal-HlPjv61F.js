import{j as e}from"./ui-Cj8tNzmz.js";import{A as P,a as E,C as se}from"./alert-oOjVmAZJ.js";import{B as ae}from"./badge-Cd2sx6iM.js";import{a as I,c as k,B as j}from"./createLucideIcon-DiPseUVF.js";import{D as re,a as le,b as oe,c as ne,d as ie,e as ce}from"./dialog-CBC3IB3i.js";import{L as de}from"./label-Cy5ruKA9.js";import{r as l,a as T}from"./inertia-C4EOeDop.js";import{u as xe}from"./app-C407sp3e.js";import{c as me,C as F}from"./Close-N_b2r1ZG.js";import{P as pe}from"./PrecisionManufacturing-CFGAssoc.js";import{D as he}from"./download-BIpjet3i.js";import{C as q}from"./check-CQXnmWxQ.js";const O=me(e.jsx("path",{d:"M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8zm4 18H6V4h7v5h5zM8 15.01l1.41 1.41L11 14.84V19h2v-4.16l1.59 1.59L16 15.01 12.01 11z"}));/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],R=I("FileText",ue);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],fe=I("Info",ge);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]],je=I("Upload",ve),V=l.forwardRef(({className:n,value:r=0,max:c=100,...t},o)=>{const g=Math.min(Math.max(r/c*100,0),100);return e.jsx("div",{ref:o,className:k("relative h-2 w-full overflow-hidden rounded-full bg-gray-200 dark:bg-gray-800",n),...t,children:e.jsx("div",{className:"h-full bg-blue-600 transition-all duration-300 ease-in-out",style:{width:`${g}%`}})})});V.displayName="Progress";const M=l.createContext(void 0),be=({defaultValue:n="",value:r,onValueChange:c,children:t,className:o})=>{const[g,f]=l.useState(n),d=r!==void 0?r:g,b=v=>{r===void 0&&f(v),c?.(v)};return e.jsx(M.Provider,{value:{value:d,onValueChange:b},children:e.jsx("div",{className:o,children:t})})},ye=({className:n,children:r})=>e.jsx("div",{className:k("inline-flex h-10 items-center justify-center rounded-md bg-gray-100 p-1 text-gray-500 dark:bg-gray-800 dark:text-gray-400",n),children:r}),H=({className:n,value:r,children:c})=>{const t=l.useContext(M);if(!t)throw new Error("TabsTrigger must be used within a Tabs component");const o=t.value===r;return e.jsx("button",{onClick:()=>t.onValueChange(r),className:k("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-white transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",o?"bg-white text-gray-950 shadow-sm dark:bg-gray-950 dark:text-gray-50":"hover:bg-gray-200 dark:hover:bg-gray-700",n),children:c})},U=({className:n,value:r,children:c})=>{const t=l.useContext(M);if(!t)throw new Error("TabsContent must be used within a Tabs component");return t.value!==r?null:e.jsx("div",{className:k("mt-2 ring-offset-white focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2",n),children:c})},Ne=({open:n,onOpenChange:r,onImportComplete:c})=>{const{t}=xe(),[o,g]=l.useState(null),[f,d]=l.useState(!1),[b,v]=l.useState([]),[x,D]=l.useState(null),[y,m]=l.useState([]),[p,i]=l.useState("upload"),[z,N]=l.useState(0),[C,w]=l.useState(!1),_=l.useRef(null),$=s=>{const a=s.target.files?.[0];a&&L(a)},L=s=>{if(!["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-excel"].includes(s.type)&&!s.name.endsWith(".xlsx")&&!s.name.endsWith(".xls")){alert(t("excel.import.validation.invalid_file"));return}const h=10*1024*1024;if(s.size>h){alert(t("excel.import.validation.file_too_large"));return}g(s),v([]),D(null),m([]),i("upload")},B=s=>{s.preventDefault(),s.stopPropagation(),w(!0)},A=s=>{s.preventDefault(),s.stopPropagation(),w(!1)},W=s=>{s.preventDefault(),s.stopPropagation()},Z=s=>{s.preventDefault(),s.stopPropagation(),w(!1);const a=s.dataTransfer.files;a.length>0&&L(a[0])},G=async()=>{try{d(!0);const s=await T.get("/equipment/download-template",{responseType:"blob"}),a=new Blob([s.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),h=window.URL.createObjectURL(a),u=document.createElement("a");u.href=h,u.download=`plantilla_equipos_${new Date().toISOString().split("T")[0]}.xlsx`,document.body.appendChild(u),u.click(),document.body.removeChild(u),window.URL.revokeObjectURL(h)}catch(s){console.error("Error al descargar la plantilla:",s)}finally{d(!1)}},J=async()=>{if(o)try{d(!0);const s=new FormData;s.append("file",o);const a=await T.post("/equipment/preview-import",s,{headers:{"Content-Type":"multipart/form-data"}});a.data.success?(v(a.data.preview_data),D(a.data.stats),m(a.data.errors),i("preview")):(m(a.data.errors||[]),i("preview"))}catch(s){console.error("Error en la vista previa:",s),s.response?.data?.errors&&(m(s.response.data.errors),i("preview"))}finally{d(!1)}},K=async()=>{if(o)try{d(!0),i("importing"),N(0);const s=new FormData;s.append("file",o);const a=setInterval(()=>{N(u=>Math.min(u+10,90))},200),h=await T.post("/equipment/import",s,{headers:{"Content-Type":"multipart/form-data"}});clearInterval(a),N(100),setTimeout(()=>{h.data.success?(i("complete"),c()):(m(h.data.errors||[]),i("preview"))},500)}catch(s){console.error("Error en la importaciÃ³n:",s),i("preview"),s.response?.data?.errors&&m(s.response.data.errors)}finally{d(!1)}},Q=()=>{g(null),v([]),D(null),m([]),i("upload"),N(0),w(!1),_.current&&(_.current.value="")},S=()=>{Q(),r(!1)},X=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs(P,{children:[e.jsx(fe,{className:"h-4 w-4"}),e.jsx(E,{children:t("excel.import.info")})]}),e.jsx("div",{className:"flex gap-4",children:e.jsxs(j,{variant:"outline",onClick:G,disabled:f,className:"flex-1",children:[e.jsx(he,{className:"mr-2 h-4 w-4"}),t("excel.import.download_template")]})}),e.jsxs("div",{className:`cursor-pointer rounded-lg border-2 border-dashed p-8 text-center transition-colors ${C?"border-blue-400 bg-blue-50":"border-gray-300 hover:border-gray-400 hover:bg-gray-50"}`,onDragEnter:B,onDragLeave:A,onDragOver:W,onDrop:Z,onClick:()=>_.current?.click(),children:[e.jsx(R,{className:`mx-auto h-12 w-12 ${C?"text-blue-500":"text-gray-400"}`}),e.jsxs("div",{className:"mt-4",children:[e.jsxs(de,{htmlFor:"file-upload",className:"cursor-pointer",children:[e.jsx("span",{className:"text-sm font-medium text-gray-900",children:t("excel.import.select_file")}),e.jsx("span",{className:"block text-sm text-gray-500",children:t("excel.import.drag_drop")})]}),e.jsx("input",{ref:_,id:"file-upload",type:"file",accept:".xlsx,.xls",onChange:$,className:"hidden"})]}),e.jsx("p",{className:"mt-2 text-xs text-gray-500",children:t("excel.import.file_requirements")}),C&&e.jsx("div",{className:"mt-2 text-sm font-medium text-blue-600",children:t("excel.import.drop_file")})]}),o&&e.jsx("div",{className:"rounded-lg bg-gray-50 p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(R,{className:"mr-3 h-5 w-5 text-blue-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium",children:o.name}),e.jsxs("p",{className:"text-xs text-gray-500",children:[(o.size/1024/1024).toFixed(2)," ","MB"]})]}),e.jsx(j,{size:"sm",onClick:J,disabled:f,children:t(f?"excel.import.analyzing":"excel.import.preview")})]})})]}),Y=()=>e.jsxs("div",{className:"space-y-6",children:[x&&e.jsxs("div",{className:"grid grid-cols-2 gap-4 md:grid-cols-4",children:[e.jsxs("div",{className:"rounded-lg bg-blue-50 p-3 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:x.total}),e.jsx("div",{className:"text-sm text-blue-800",children:t("excel.import.stats.total")})]}),e.jsxs("div",{className:"rounded-lg bg-green-50 p-3 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:x.will_create}),e.jsx("div",{className:"text-sm text-green-800",children:t("excel.import.stats.new")})]}),e.jsxs("div",{className:"rounded-lg bg-yellow-50 p-3 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:x.will_update}),e.jsx("div",{className:"text-sm text-yellow-800",children:t("excel.import.stats.update")})]}),e.jsxs("div",{className:"rounded-lg bg-red-50 p-3 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:x.errors}),e.jsx("div",{className:"text-sm text-red-800",children:t("excel.import.stats.errors")})]})]}),e.jsxs(be,{defaultValue:"preview",className:"w-full",children:[e.jsxs(ye,{className:"grid w-full grid-cols-2",children:[e.jsxs(H,{value:"preview",children:[t("excel.import.tabs.preview")," (",b.length,")"]}),e.jsxs(H,{value:"errors",children:[t("excel.import.tabs.errors")," (",y.length,")"]})]}),e.jsx(U,{value:"preview",className:"space-y-4",children:b.length>0?e.jsx("div",{className:"overflow-hidden rounded-lg border",children:e.jsx("div",{className:"max-h-96 overflow-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"sticky top-0 bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-left",children:t("excel.import.table.instrument")}),e.jsx("th",{className:"px-3 py-2 text-left",children:t("excel.import.table.code")}),e.jsx("th",{className:"px-3 py-2 text-left",children:t("excel.import.table.brand")}),e.jsx("th",{className:"px-3 py-2 text-left",children:t("excel.import.table.model")}),e.jsx("th",{className:"px-3 py-2 text-left",children:t("excel.import.table.status")})]})}),e.jsx("tbody",{children:b.map((s,a)=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"px-3 py-2",children:s.instrumento}),e.jsx("td",{className:"px-3 py-2",children:s.codigo_interno}),e.jsx("td",{className:"px-3 py-2",children:s.marca}),e.jsx("td",{className:"px-3 py-2",children:s.modelo}),e.jsx("td",{className:"px-3 py-2",children:e.jsx(ae,{variant:s.activo_true_false?"default":"secondary",children:s.activo_true_false?t("status.active"):t("status.inactive")})})]},a))})]})})}):e.jsx("div",{className:"py-8 text-center text-gray-500",children:t("excel.import.no_data")})}),e.jsx(U,{value:"errors",className:"space-y-4",children:y.length>0?e.jsx("div",{className:"space-y-3",children:y.map((s,a)=>e.jsxs(P,{variant:"destructive",children:[e.jsx(se,{className:"h-4 w-4"}),e.jsxs(E,{children:[e.jsxs("strong",{children:[t("excel.import.row")," ",s.row,":"]})," ",s.errors.join(", ")]})]},a))}):e.jsxs("div",{className:"py-8 text-center text-gray-500",children:[e.jsx(q,{className:"mx-auto mb-2 h-12 w-12 text-green-500"}),t("excel.import.no_errors")]})})]})]}),ee=()=>e.jsxs("div",{className:"space-y-6 text-center",children:[e.jsx(je,{className:"mx-auto h-16 w-16 text-blue-500"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium",children:t("excel.import.importing")}),e.jsx("p",{className:"text-sm text-gray-500",children:t("excel.import.importing_wait")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{value:z,className:"w-full"}),e.jsxs("p",{className:"text-sm text-gray-500",children:[z,t("excel.import.progress")]})]})]}),te=()=>e.jsxs("div",{className:"space-y-6 text-center",children:[e.jsx(q,{className:"mx-auto h-16 w-16 text-green-500"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-green-700",children:t("excel.import.completed")}),e.jsx("p",{className:"text-sm text-gray-500",children:t("excel.import.completed_message")})]}),x&&e.jsx("div",{className:"rounded-lg bg-green-50 p-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:t("excel.import.equipment_created")})," ",x.will_create]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:t("excel.import.equipment_updated")})," ",x.will_update]})]})})]});return e.jsx(re,{open:n,onOpenChange:S,children:e.jsxs(le,{className:"max-h-[90vh] max-w-4xl overflow-auto",children:[e.jsxs(oe,{children:[e.jsxs(ne,{className:"flex items-center gap-3 text-xl font-bold",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-lg bg-gradient-to-br from-orange-500 to-orange-700 shadow-lg",children:e.jsx(O,{sx:{color:"white",fontSize:24}})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:t("excel.import.title")}),e.jsx(pe,{sx:{color:"#f97316",fontSize:28}})]})]}),e.jsx(ie,{className:"ml-13 text-gray-600",children:t("excel.import.description")})]}),e.jsxs("div",{className:"py-6",children:[p==="upload"&&X(),p==="preview"&&Y(),p==="importing"&&ee(),p==="complete"&&te()]}),e.jsxs(ce,{children:[p==="upload"&&e.jsxs(j,{variant:"outline",onClick:S,className:"rounded-full border-2 border-blue-600 px-6 py-2 text-sm font-semibold tracking-wide text-blue-600 uppercase transition-colors hover:bg-blue-50",children:[e.jsx(F,{sx:{fontSize:16,marginRight:1}}),t("common.cancel")]}),p==="preview"&&e.jsxs(e.Fragment,{children:[e.jsxs(j,{variant:"outline",onClick:()=>i("upload"),className:"rounded-full border-2 border-blue-600 px-6 py-2 text-sm font-semibold tracking-wide text-blue-600 uppercase transition-colors hover:bg-blue-50",children:[e.jsx(F,{sx:{fontSize:16,marginRight:1}}),t("excel.import.back")]}),e.jsxs(j,{onClick:K,disabled:f||y.length>0,className:"min-h-[40px] rounded-2xl bg-gradient-to-r from-orange-600 to-orange-700 px-6 py-2 text-base font-bold text-white transition-all hover:from-orange-700 hover:to-orange-800",children:[e.jsx(O,{sx:{color:"white",fontSize:24}}),t("excel.import.import_equipment")]})]}),p==="complete"&&e.jsx(j,{onClick:S,className:"min-h-[40px] rounded-2xl bg-gradient-to-r from-green-600 to-green-700 px-6 py-2 text-base font-bold text-white transition-all hover:from-green-700 hover:to-green-800",children:t("common.close")})]})]})})},Ee=Object.freeze(Object.defineProperty({__proto__:null,default:Ne},Symbol.toStringTag,{value:"Module"}));export{Ne as E,je as U,Ee as a};
